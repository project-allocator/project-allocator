# Project Allocator v3

Welcome to Project Allocator v3!

This is the repository that contains:

* Backend code for the project allocator.
* GitHub workflow to build and push the Docker image to GHCR.
    * Which will be consumed by the `project-allocator-deploy` repository.

## Tech Stack

* React with TypeScript
* Vite for development server
* Yarn for package manager
* Ant Design for UI components
* Tailwind CSS for custom styling
* React Router v6 for routing

## Code Structure

* `public/`
    * Contains public assets like favicon
* `src/`
    * `api/`
        * API client auto-generated by `openapi-typescript-codegen`
        * Do not modify files in this directory
    * `components/`
        * Contains shared UI layouts and components e.g. `ProjectForm`
    * `contexts/`
        * `ConfigContext.tsx`
            * React context for loading configuration from the backend's `config.yaml` via API
        * `MessageContext.tsx`
            * React context for showing popup messages at the bottom right of the screen
        * `UserContext.tsx`
            * React context for providing information for the currently logged-in user
    * `pages/`
        * Contains pages
    * `routes/`
        * Contains routes (guards)
        * Allows page access based on user role etc.
    * `index.css`
        * Contains global CSS code
    * `auth.ts`
        * Sets up `msal-react` to authenticate users with Microsoft SSO
    * `utils.ts`
        * Contains utility functions for case conversion etc.
    * `main.tsx`
        * Main entry point for the frontend
        * Sets up routes (mapping URLs to pages) and contexts
* `.env`
    * Sets up environment variables for local development
    * Environment variables for production development are provided via Appvia Wayfinder
* `Dockerfile`
    * Dockerfile for local development
* `Dockerfile.production`
    * Dockerfile for production on Azure
    * Takes security constraints of Appvia Wayfinder into account
* `config.yaml`
    * Configuration for the Project Allocator
    * See the deployment repository for more details

## Development Guide

### Hot Reload

The frontend server automatically when it detects any changes under the root directory.

But this may fail if you edit some of the configuration files e.g. package.json. In case of such failure, try running:

```bash
~$ docker compose restart --build frontend
```

### Entering the container

```bash
~$ docker compose up -d
~$ docker compose exec -it frontend /bin/bash
```

### Auto-generate API client

When you update the API endpoint (e.g. URL), make sure to run the following command:

```bash
~$ yarn run generate
```

This will auto-generate the API client under `src/api/` by asking the backend server about its specification.

In fact, this command is run every minute inside the development container, so things may just work without it.
And the files under `src/` are synchronised between the local machine and the development container, meaning you will see the changes on your editor immediately.

In case of any failure, you will need to restart the frontend container by:

1. `cd` into `project-allocator-deploy`.
2. Run `docker-compose restart frontend`.

Note that the names of the client functions auto-generated are based on the names of Python functions in the backend
e.g. `read_project()` to `ReadProject`, so you may need to update your client code if you renamed one of them.
